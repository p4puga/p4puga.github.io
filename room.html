<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link rel="stylesheet" href="style2.css">
<link rel="icon" type="image/png" href="pajak.webp">
<title>SigmaGame Room</title>
<style>
    .chatroom p {
        display: flex;
        align-items: center;
        gap: 8px;
        margin: 5px 0;
    }
    .chatroom img {
        width: 30px;
        height: 30px;
        border-radius: 50%;
    }
    .player-list {
        display: flex;
        flex-direction: column;
        gap: 5px;
        padding: 5px;
    }
    .player {
        display: flex;
        align-items: center;
        gap: 8px;
    }
    .player img {
        width: 40px;
        height: 40px;
        border-radius: 50%;
    }
</style>
</head>
<body>
<header><h1 id="roomHeader">SigmaGame</h1></header>
<main>
<section class="game">
    <h2>Gracze</h2>
    <div class="player-list" id="playerList"></div>
</section>
<section class="chat">
    <div class="Chatting"><p>Chat</p></div>
    <div class="chatroom" id="chatroom"></div>
    <input type="text" id="message" placeholder="Type a message">
    <button id="sendBtn">Send</button>
</section>
</main>
<footer><p>©2025 SigmaGame BETA</p></footer>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-app.js";
import { getDatabase, ref, onValue, update, get } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-database.js";

const firebaseConfig = {
  apiKey: "AIzaSyDgc1Vn0WDPT9a6xZr_t_Qni8NdiH5EejE",
  authDomain: "sigmagame-9858a.firebaseapp.com",
  projectId: "sigmagame-9858a",
  storageBucket: "sigmagame-9858a.firebasestorage.app",
  messagingSenderId: "305980813593",
  appId: "1:305980813593:web:ed25bd118d2b29ba595588",
  measurementId: "G-PN90HB388K"
};

const app = initializeApp(firebaseConfig);
const db = getDatabase(app);

const urlParams = new URLSearchParams(window.location.search);
const roomID = urlParams.get('roomID');
const username = urlParams.get('username');

document.getElementById('roomHeader').textContent = `SigmaGame - ${roomID}`;

const chatroom = document.getElementById('chatroom');
const playerList = document.getElementById('playerList');
const messageInput = document.getElementById('message');
const sendBtn = document.getElementById('sendBtn');

// aktualizacja listy graczy i wiadomości w czasie rzeczywistym
onValue(ref(db, 'rooms/' + roomID), (snapshot) => {
  if (!snapshot.exists()) return;
  const data = snapshot.val();
  chatroom.innerHTML = data.messages.map(msg => `<p><strong>${msg.user}:</strong> ${msg.text}</p>`).join('');
  playerList.innerHTML = data.users.map(user => `<div class="player"><span>${user}</span></div>`).join('');
});

sendBtn.addEventListener('click', sendMessage);
messageInput.addEventListener('keypress', e => {
  if (e.key === 'Enter') sendMessage();
});

async function sendMessage() {
  const text = messageInput.value.trim();
  if (!text) return;
  const snapshot = await get(ref(db, 'rooms/' + roomID));
  if (snapshot.exists()) {
    const data = snapshot.val();
    data.messages.push({ user: username, text });
    await update(ref(db, 'rooms/' + roomID), data);
    messageInput.value = '';
  }
}
</script>

</body>
</html>
